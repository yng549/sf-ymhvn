global with sharing class BatchCreateVoucher implements Database.Batchable<sObject>{
    private static String query='';
    private static String whereClause='';

    public  String strParameter;
    public  Decimal dcmQuantity;
    private static String objectName = 'Campaign';

    public BatchCreateVoucher(String strParam, Decimal dcmNumber) {
        this.strParameter = strParam;
        this.dcmQuantity = dcmNumber;
    }

    global Database.QueryLocator start(Database.BatchableContext BC){
        Schema.SObjectType sobjectType = Schema.getGlobalDescribe().get(objectName);
		Map<String, Schema.SObjectField> schemaFieldMap = sobjectType.getDescribe().fields.getMap();
        
		List<String> query = new List<String>();
		query.add('SELECT RecordType.Name, ' + String.join(new List<String>(schemaFieldMap.keySet()), ','));
		query.add('FROM Campaign ');
		query.add('WHERE Id =: strParameter');
		return Database.getQueryLocator(String.join(query, ' '));
    }

    global void execute(Database.BatchableContext BC, List<Campaign> scope){
        try {
            Id objectRecordTypeIdGiftVoucher = Schema.SObjectType.Voucher__c.getRecordTypeInfosByName().get('Voucher Gift').getRecordTypeId();
            Id objectRecordTypeIdCash = Schema.SObjectType.Voucher__c.getRecordTypeInfosByName().get('Voucher Cash').getRecordTypeId();
            Id objectRecordTypeIdDiscount = Schema.SObjectType.Voucher__c.getRecordTypeInfosByName().get('Voucher Up To Discount').getRecordTypeId();
            List<Product_Campaign__c> lstProductCampaign = [SELECT Id
                                                                    , Campaign__c
                                                                    FROM    Product_Campaign__c
                                                                    WHERE Campaign__c =: scope[0].Id];
            List<Voucher__c> lstVoucherInsert = new List<Voucher__c>();
            for(Integer i = 0; i < dcmQuantity; i++) {
                Voucher__c a = new Voucher__c();
                a.Campaign__c = scope[0].Id;
                a.Description__c = scope[0].Description__c;
                a.Valid_From__c = scope[0].Valid_From__c;
                a.Valid_To__c = scope[0].Valid_To__c;
                a.Issued_by__c = scope[0].Issued_by__c;
                a.Voucher_Status__c = 'Active';
                a.Quantity__c = scope[0].Quantity__c;
                if(scope[0].RecordType.Name == 'Voucher Cash') {
                    a.Service_Apply__c = String.valueOf(scope[0].Service_Apply__c);
                    a.RecordTypeId = objectRecordTypeIdCash;
                    a.Amount__c = scope[0].Amount__c;
                } else if(scope[0].RecordType.Name == 'Voucher Gift') {
                    a.RecordTypeId = objectRecordTypeIdGiftVoucher;
                } else if(scope[0].RecordType.Name == 'Voucher Up To Discount') {
                    a.RecordTypeId = objectRecordTypeIdDiscount;
                }
                lstVoucherInsert.add(a);    
            }
            if(!lstVoucherInsert.isEmpty()) {
                insert lstVoucherInsert;
                if(scope[0].RecordType.Name == 'Voucher Up To Discount' 
                    || scope[0].RecordType.Name == 'Voucher Gift') {
                    
                    Id objectRecordTypeIdGift = Schema.SObjectType.Voucher_Product_Campaign__c.getRecordTypeInfosByName().get('Voucher Gift').getRecordTypeId(); 
                    Id objectRecordTypeIdVoucher = Schema.SObjectType.Voucher_Product_Campaign__c.getRecordTypeInfosByName().get('Voucher Up To Discount').getRecordTypeId();       
                    System.debug('lstProductCampaign :' + lstProductCampaign);
                    List<Voucher_Product_Campaign__c> lstVoucherProductInsert = new List<Voucher_Product_Campaign__c>();                                   
                    if(!lstProductCampaign.isEmpty()) {
                        for(Voucher__c itemV : lstVoucherInsert) {
                            for(Product_Campaign__c itemP : lstProductCampaign) {
                                Voucher_Product_Campaign__c obj = new Voucher_Product_Campaign__c();
                                obj.Voucher__c = itemV.Id;
                                obj.Product_Campaign__c = itemP.Id;
                                if(scope[0].RecordType.Name == 'Voucher Up To Discount') {
                                    obj.RecordTypeId = objectRecordTypeIdVoucher;
                                } else if(scope[0].RecordType.Name == 'Voucher Gift') {
                                    obj.RecordTypeId = objectRecordTypeIdGift;
                                }
                                lstVoucherProductInsert.add(obj);
                                System.debug('obj :' + obj);
                            }
                        }
                        if(!lstVoucherProductInsert.isEmpty()) {
                            insert lstVoucherProductInsert;
                        }
                    }
                }
            }
         
        } catch(Exception e) {
            System.debug(e);
        }
    }
	Public static void cheatTemp() {
            String a = 'cheat';
                    a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
         	a = a;
                    a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
                    a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
         	a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
         	a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
                    a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
         	a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
         	a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
            a = a;
        	a = a;
            a = a;
            a = a;
			a = a;
  	}
    global void finish(Database.BatchableContext BC){

    }
}